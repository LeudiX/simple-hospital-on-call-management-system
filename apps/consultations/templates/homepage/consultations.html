{% extends "base/base.html" %}
{% load crispy_forms_tags %}

{% block navbar %}
    {% include 'homepage/magic-nav.html' %}
 {% endblock %}


{% block content %}
    <div class="row g-3 text-white">
        <h1>Consultations</h1>
        {% if user.is_doctor %}
            <div class="col-sm-6">
                <form method="post">
                    {% csrf_token %}
                    
                    {{ patient_consultation_form|crispy }}<!-- Patient Consultation Form -->
                    {{form|crispy}} <!-- Main Consultation Form -->
                    <!-- Additional forms based on consultation type -->
                    {% if consultation_type == 'urgency' %}
                      {{ urgency_consultation_form|crispy}}
                    {% elif consultation_type == 'common' %}
                      {{ common_consultation_form|crispy}}
                    {% endif %}
                    {{ vital_signs_form|crispy }} <!-- Vital Signs Form -->
                    <button type="submit" class="btn btn-success">Create Consultation</button>
                </form>
            </div>
            <div class="col-sm px-5">
                <h4>Patient Consultation's Historial</h4>
                <ul>
                    <!--Object_List reference is defined in views as a context variable-->
                    {% for consultation in object_list %}
                    <li class='py-2'>
                        <b>Patient:</b> {{ consultation.user.get_full_name }}<br>
                        <b>Date:</b> {{ consultation.consultation_date }}<br>
                        <b>Notes:</b> {{ consultation.notes }}
                    </li>
                    {% endfor %}
                </ul>   
            </div>
        {% elif user.is_patient %}
            <div class="col-sm-6">
                <h4>Patient Consultation's Historial</h4>
                <ul>
                    <!--Object_List reference is defined in views as a context variable-->
                    {% for consultation in object_list %}
                    <li class='py-2'>
                        <b>Patient:</b> {{ consultation.patient.user.get_full_name }}<br>
                        <b>Consultated by:</b> {{ consultation.doctor.user.get_full_name }}<br>
                        <b>Date:</b> {{ consultation.consultation_date }}<br>
                        <b>Notes:</b> {{ consultation.notes }}
                    </li>
                    {% endfor %}
                </ul>   
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block script %}
<script>
    document.getElementById('consultations').classList.add('active');
</script>
{% endblock %}